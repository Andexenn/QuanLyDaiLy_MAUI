<?xml version="1.0" encoding="utf-8" ?>
<toolkit:Popup xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="QuanLyDaiLy_MAUI.Views.DaiLyViews.LapPhieuXuatModal"
             xmlns:viewmodels="clr-namespace:QuanLyDaiLy_MAUI.ViewModels.PhieuXuatViewModels"
             xmlns:models="clr-namespace:QuanLyDaiLy_MAUI.Models"
             xmlns:converters="clr-namespace:QuanLyDaiLy_MAUI.Converters"
             x:DataType="viewmodels:LapPhieuXuatModalViewModel"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit">

    <toolkit:Popup.Resources>
        <ResourceDictionary>
            <converters:MaLoaiDaiLyToNoToiDaConverter x:Key="MaLoaiDaiLyToNoToiDaConverter"/>
            <converters:MaDonViTinhToTenDonViTinhConverter x:Key="MaDonViTinhToTenDonViTinhConverter"/> 
            <Style TargetType="Label" x:Key="title">
                <Setter Property="Text" Value="Lập Phiếu xuất hàng"/>
                <Setter Property="TextColor" Value="Black"/>
                <Setter Property="FontFamily" Value="MontserratBold"/>
                <Setter Property="FontSize" Value="25"/>
            </Style>

            <Style TargetType="Button" x:Key="x_symbol">
                <Setter Property="Grid.Column" Value="2"/>
                <Setter Property="FontFamily" Value="FontAwesomeSolid"/>
                <Setter Property="Text" Value="{x:Static models:FontAwesome.x}"/>
                <Setter Property="TextColor" Value="Black"/>
                <Setter Property="BackgroundColor" Value="#a3a3a3"/>
            </Style>

            <Style TargetType="Label" x:Key="input">
                <Setter Property="TextColor" Value="Black"/>
                <Setter Property="FontFamily" Value="MontserratSemiBold"/>
                <Setter Property="FontSize" Value="15"/>
                <Setter Property="HorizontalOptions" Value="Center"/>
                <Setter Property="VerticalOptions" Value="Center"/>
            </Style>

            <Style TargetType="Button" x:Key="button">
                <Setter Property="BackgroundColor" Value="#00AAFF"/>
                <Setter Property="TextColor" Value="White"/>
                <Setter Property="Shadow">
                    <Setter.Value>
                        <Shadow Brush="Black" Offset="0,1" Radius="5" Opacity="0.3"/>
                    </Setter.Value>
                </Setter>
                <Setter Property="HorizontalOptions" Value="Center"/>
            </Style>

            <Style TargetType="Label" x:Key="content">
                <Setter Property="TextColor" Value="Black"/>
                <Setter Property="FontFamily" Value="MontserratRegular"/>
                <Setter Property="FontSize" Value="13"/>
                <Setter Property="HorizontalOptions" Value="Center"/>
                <Setter Property="VerticalOptions" Value="Center"/>
            </Style>
        </ResourceDictionary>
    </toolkit:Popup.Resources>

    
    <Grid RowDefinitions="Auto, Auto, Auto" RowSpacing="15">
        <VerticalStackLayout Spacing="15">
            <Grid ColumnDefinitions="auto,*,auto">
                <Label Style="{StaticResource title}"/>
                <Button Style="{StaticResource x_symbol}" Command="{Binding CloseWindowCommand}"/>
            </Grid>
            
            <BoxView HeightRequest="2" Color="Black"/>
        </VerticalStackLayout>

        <VerticalStackLayout Grid.Row="1" Spacing="15" >
            <Border StrokeShape="RoundRectangle 10" BackgroundColor="#f7f9fd" Padding="10" >
                <Grid RowDefinitions="Auto, Auto" RowSpacing="15">
            

                    <Grid ColumnDefinitions="*,*,*,*,*,*" ColumnSpacing="5">
                        <VerticalStackLayout Grid.Column="0" Spacing="5">
                            <Label Style="{StaticResource input}" Text="Mã Phiếu xuất" />
                            <Border StrokeShape="RoundRectangle 10" BackgroundColor="#a2a2a2">
                                <Entry TextColor="Black" IsReadOnly="True" Text="{Binding MaPhieuXuat}"/>
                            </Border>
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="1" Spacing="5">
                            <Label Style="{StaticResource input}" Text="Tên đại lý"/>
                            <Border StrokeShape="RoundRectangle 10" BackgroundColor="#a2a2a2">
                                <Picker TextColor="Black" SelectedItem="{Binding SelectedDaiLy, Mode=TwoWay}" ItemsSource="{Binding DaiLies}" ItemDisplayBinding="{Binding TenDaiLy}" />
                            </Border>
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="2" Spacing="5">
                            <Label Style="{StaticResource input}" Text="Nợ đại lý"/>
                            <Border StrokeShape="RoundRectangle 10" BackgroundColor="#a2a2a2">
                                <Entry TextColor="Black" IsReadOnly="True" Text="{Binding SelectedDaiLy.NoDaiLy}"/>
                            </Border>
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="3" Spacing="5">
                            <Label Style="{StaticResource input}" Text="Nợ tối đa"/>
                            <Border StrokeShape="RoundRectangle 10" BackgroundColor="#a2a2a2">
                                <Entry TextColor="Black" IsReadOnly="True" Text="{Binding SelectedDaiLy.MaLoaiDaiLy, Converter={StaticResource MaLoaiDaiLyToNoToiDaConverter}, Mode=OneWay}"/>
                            </Border>
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="4" Spacing="5">
                            <Label Style="{StaticResource input}" Text="Ngày lập"/>
                            <Border StrokeShape="RoundRectangle 10" BackgroundColor="#a2a2a2">
                                <Entry IsReadOnly="True" Text="{Binding NgayLapPhieu, StringFormat='{0:dd/MM/yyyy}' }" TextColor="Black"  />
                            </Border>
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="5" Spacing="5">
                            <Label Style="{StaticResource input}" Text="Tổng tiền"/>
                            <Border StrokeShape="RoundRectangle 10" BackgroundColor="#a2a2a2">
                                <Entry TextColor="Black" IsReadOnly="True" Text="{Binding TongTien}"/>
                            </Border>
                        </VerticalStackLayout>
                    </Grid>

                    <Border Grid.Row="1" StrokeShape="RoundRectangle 10" BackgroundColor="White">
                        <Grid RowDefinitions="Auto, *">
                            <ScrollView Orientation="Horizontal">
                                <VerticalStackLayout HorizontalOptions="Start">
                                    <Grid ColumnDefinitions="*, *, *, *, *, *, *" ColumnSpacing="20" RowDefinitions="*,*" Padding="10,15,10,0" RowSpacing="15">
                                        <Label Style="{StaticResource input}" Text="STT" Grid.Column="0" />
                                        <Label Style="{StaticResource input}" Text="TÊN MẶT HÀNG" Grid.Column="1"/>
                                        <Label Style="{StaticResource input}" Text="TÊN ĐƠN VỊ TÍNH"  Grid.Column="2"/>
                                        <Label Style="{StaticResource input}" Text="SỐ LƯỢNG TỒN" Grid.Column="3"/>
                                        <Label Style="{StaticResource input}" Text="SỐ LƯỢNG XUẤT" Grid.Column="4"/>
                                        <Label Style="{StaticResource input}" Text="ĐƠN GIÁ XUẤT" Grid.Column="5"/>
                                        <Label Style="{StaticResource input}" Text="THÀNH TIỀN" Grid.Column="6"/>
                                    </Grid>
                                    <BoxView HeightRequest="2"/>
                                </VerticalStackLayout>
                            </ScrollView>
                            <ScrollView Grid.Row="1" Orientation="Both" HeightRequest="200" IsVisible="{Binding IsNotLoading}">
                                <CollectionView ItemsSource="{Binding MatHangXuats}">
                                    <CollectionView.ItemTemplate>
                                        <DataTemplate x:DataType="viewmodels:MatHangXuat">
                                            <VerticalStackLayout>
                                                <Grid  ColumnDefinitions="*, *, *, *, *, *, *" ColumnSpacing="20" Padding="10,5,10,0">
                                                    <Label Style="{StaticResource input}" Text="{Binding SoThuTu}" Grid.Column="0" />
                                                    <Picker BackgroundColor="#f7f9fd" HorizontalOptions="Center" VerticalOptions="Center" Grid.Column="1" TextColor="Black" SelectedItem="{Binding MatHang, Mode=TwoWay}" ItemsSource="{Binding x:DataType='viewmodels:LapPhieuXuatModalViewModel', Source={RelativeSource AncestorType={x:Type viewmodels:LapPhieuXuatModalViewModel}}, Path=MatHangs}" ItemDisplayBinding="{Binding TenMatHang}" />
                                                    <Label Style="{StaticResource input}" Text="{Binding MatHang.MaDonViTinh, Converter={converters:MaDonViTinhToTenDonViTinhConverter}}"  Grid.Column="2"/>
                                                    <Label Style="{StaticResource input}" Text="{Binding MatHang.SoLuongTon}" Grid.Column="3"/>
                                                    <Entry HorizontalOptions="Center" Text="{Binding SoLuongXuat, Mode=TwoWay}" TextColor="Black" Grid.Column="4"/>
                                                    <Entry HorizontalOptions="Center" Text="{Binding DonGiaXuat, Mode=TwoWay}" TextColor="Black" Grid.Column="5"/>
                                                    <Label Style="{StaticResource input}" Text="{Binding GiaXuat}" Grid.Column="6"/>
                                                </Grid>
                                                <BoxView HeightRequest="2"/>
                                            </VerticalStackLayout>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>
                            </ScrollView>
                            <ActivityIndicator Grid.Row="1"
                                                HeightRequest="50"
                                                HorizontalOptions="Center"
                                                IsRunning="{Binding IsLoading}"
                                                IsVisible="{Binding IsLoading}"
                                                VerticalOptions="Center"
                                                WidthRequest="50"
                                                Color="Blue" />
                        </Grid>
                    </Border>
                </Grid>
            </Border>
            <BoxView HeightRequest="2" Color="Black"/>
        </VerticalStackLayout>

        <HorizontalStackLayout Grid.Row="2" HorizontalOptions="Center" Spacing="20">
            <Button Text="Lập Phiếu xuất" Style="{StaticResource button}" Command="{Binding LapPhieuXuatCommand}"/>
            <Button Text="Phiếu xuất mới" Style="{StaticResource button}" Command="{Binding NewPhieuXuatCommand}"/>
            <Button Text="Tìm phiếu xuất" Style="{StaticResource button}"/>
            <Button Text="Xoá phiếu xuất" Style="{StaticResource button}"/>
            <Button Text="Cập nhật phiếu xuất" Style="{StaticResource button}"/>
            <Button Text="Thoát" Style="{StaticResource button}" Command="{Binding CloseWindowCommand}"/>
        </HorizontalStackLayout>
    </Grid>
    
</toolkit:Popup>